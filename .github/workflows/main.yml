# This is a basic workflow to help you get started with Actions

name: Deploy
on:
  push:
    branches: [ main, cd-test-deploy ]
  pull_request:
    branches: [ main ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: self-hosted

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      
      - name: Setup BusinessInitiative database
        run: |
          docker stop business-mysql 2>/dev/null
          docker rm business-mysql 2>/dev/null
          docker run --name business-mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=password -e MYSQL_DATABASE=business-mysql -e MYSQL_USER=tqs -e MYSQL_PASSWORD=password -d mysql:5.6
  
      - name: Setup BusinessInitiative
        run: |
          cd BusinessInitiative
          ./mvnw package -DskipTests
          docker stop business-initiative 2>/dev/null
          docker rm business-initiative 2>/dev/null
          docker build -t business-initiative .
          docker run -d -p 8090:8090 --name business-initiative --link business-mysql:mysql business-initiative



        


        
        
        
        
        
        
        
